# OCR 統合設計（次フェーズ用のメモ）

## 目的
- 最終的に「シリーズ/型番ごとの窓の数量」を出す。
- 画像だけで型番が分からない場合は **UIでユーザー確認**。
- 型番テキストがある場合は OCR で候補を出し、**UIで採否/修正**できる。

## OCR を入れる場所（推奨）
- **Step3（原図へ合成）後**に OCR を実行する。
  - タイル上は文字が切れやすい
  - 原図に戻すと、型番が載っている表領域を扱いやすい

## データ設計（追加ファイル）
- `outputs/ocr/ocr_lines.json`
  - 1行ごとの OCR 結果
  - 形式例：
    - `text`: 認識文字列
    - `bbox`: 原図座標（x1,y1,x2,y2）
    - `conf`: 信頼度
- `outputs/ocr/series_candidates.json`
  - 窓ごとの型番候補（ユーザー確認用）
  - 形式例：
    - `object_id`: 検出窓ID（Step3 の merged 結果と紐づけ）
    - `candidate_texts`: ["SXU-16513-S5", ...]
    - `rule_hit`: 正規表現ヒット有無

## UI フロー（想定）
1. Step3 完了後、「OCRを実行」ボタンを追加
2. OCR 結果（行一覧）を表示し、型番っぽい文字列をハイライト
3. 窓（検出BOX）ごとに近傍の OCR 行を候補として提示
4. ユーザーが選択/修正/手入力 → `series_confirmed.json` に保存
5. 最終集計は `series_confirmed.json` を最優先し、無いものは「未確定」として残す

## ルール（正規表現）の位置づけ
- Roboflow 内で“ルール”を定義するのではなく、**このアプリ側**で定義する。
- 例：`[A-Z]{2,4}[-–][0-9]{3,6}[-–][A-Z0-9]+` のような型番パターン
- ルールは「自動確定」ではなく **候補提案の優先順位付け**に使う
